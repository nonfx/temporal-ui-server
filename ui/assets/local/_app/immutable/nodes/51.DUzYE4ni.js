import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as G,az as x,aC as X,t as p,h as t,r as e,c as d,i as H,d as u,b as K,aL as ea,g as a,s as J,O as Y,f as Z,o as ta,j as ra}from"../chunks/DSxqszTl.js";import{i as sa}from"../chunks/BcaHj5WR.js";import{p as q}from"../chunks/euS3CSUO.js";import{P as oa}from"../chunks/DTWo_ajL.js";import{t as j}from"../chunks/D2OY9xdY.js";import{e as ia,s as D}from"../chunks/CXaSvchK.js";import{i as z}from"../chunks/BAt4aHTa.js";import{k as la}from"../chunks/CvtqSEth.js";import{s as S,a as C,e as da}from"../chunks/CZBNCVvj.js";import{o as na}from"../chunks/Cb3VdkNs.js";import{B as va}from"../chunks/DaP1M0Pw.js";import{I as fa}from"../chunks/Dc8cZy7F.js";import{M as Q}from"../chunks/DNa9JBK-.js";import{a as ma}from"../chunks/BJSzXd5k.js";import{a as ca}from"../chunks/DlMariDq.js";import{f as ua,r as pa,t as _a}from"../chunks/BSP6lJQ9.js";import{w as A}from"../chunks/B0rcaDAb.js";import{e as wa,i as xa}from"../chunks/B5GJuRxG.js";import{M as ha}from"../chunks/DBd80VcH.js";import{W as ga}from"../chunks/L-HzL4_-.js";import{g as $a}from"../chunks/DgiS7LO-.js";import{f as ka}from"../chunks/C52X8ujg.js";var ya=p('<p class="text-xs text-secondary"> </p>'),ba=p('<div class="flex h-full flex-1 flex-col border-l border-subtle"><div class="surface-information w-full px-6 py-2"><div class="flex items-center justify-between"><h3> </h3> <div class="flex flex-row items-center gap-2 lg:flex-col xl:flex-row"><p class="hidden sm:block">Press the <span class="mx-1 rounded bg-subtle px-1 text-sm font-medium leading-4">R</span> for freshness</p> <div class="flex items-center sm:hidden"><p>Press for freshness</p> <!></div> <!></div></div></div> <div class="surface-background h-full"><!></div></div>');function Ma(h,f){G(f,!0);const[l,_]=S(),o=()=>C(A,"$workflowRun",l),m=()=>C(ca,"$authUser",l),v=()=>C(_a,"$timeFormat",l),E=()=>C(pa,"$relativeTime",l);var g;const R=x(()=>q.params),W=x(()=>a(R).namespace),$=x(()=>o().workflow),n=x(()=>((g=o()===null||o()===void 0?void 0:o().metadata)===null||g===void 0?void 0:g.currentDetails)||"");let i=X(!1),k=X(null);const y=async()=>{if(!a(i)){J(i,!0);try{const{settings:r}=q.data,w=await ma({namespace:a(W),workflow:{id:a($).id,runId:a($).runId}},r,m()===null||m()===void 0?void 0:m().accessToken);da(A,Y(o).metadata=w,Y(o)),J(k,new Date,!0)}catch(r){console.error("Error fetching current details:",r)}finally{J(i,!1)}}};na(()=>{y()});const N=r=>{(r.key==="r"||r.key==="R")&&(r.preventDefault(),y())};var b=ba();ia("keydown",ea,N);var M=t(b),P=t(M),F=t(P),O=t(F,!0);e(F);var U=d(F,2),I=d(t(U),2),T=d(t(I),2);va(T,{variant:"ghost",get disabled(){return a(i)},$$events:{click:y},children:(r,w)=>{fa(r,{name:"retry"})},$$slots:{default:!0}}),e(I);var B=d(I,2);{var L=r=>{var w=ya(),V=t(w,!0);e(w),H(aa=>D(V,aa),[()=>ua(a(k),v(),{relative:E()})]),u(r,w)};z(B,r=>{a(k)&&r(L)})}e(U),e(P),e(M);var s=d(M,2),c=t(s);la(c,()=>a(n),r=>{Q(r,{className:"p-3",overrideTheme:"background",get content(){return a(n)}})}),e(s),e(b),H(r=>D(O,r),[()=>j("workflows.current-details")]),u(h,b),K(),_()}var Ra=p('<div class="px-6 text-secondary/70"><p class="text-sm italic">No events with metadata</p></div>'),Ta=p('<span class="text-sm"> </span>'),Da=p('<div class="flex items-center justify-between gap-4 border-b border-subtle px-3 pb-1 text-lg"><div class="flex items-center gap-2"><p class="w-32 min-w-32 text-sm font-medium"> </p> <!></div> <!></div>'),Ea=p('<!> <div class="flex flex-col gap-2"></div>',1);function Wa(h,f){G(f,!0);const[l,_]=S(),o=()=>C(A,"$workflowRun",l),m=()=>C(ka,"$fullEventHistory",l),v=x(()=>o().workflow),E=x(()=>$a(m(),"ascending",a(v)===null||a(v)===void 0?void 0:a(v).pendingActivities,a(v)===null||a(v)===void 0?void 0:a(v).pendingNexusOperations).filter(n=>{var i;return(i=n.userMetadata)===null||i===void 0?void 0:i.summary}));var g=Ea(),R=Z(g);{var W=n=>{var i=Ra();u(n,i)};z(R,n=>{a(E).length||n(W)})}var $=d(R,2);wa($,21,()=>a(E),xa,(n,i)=>{var k=Da(),y=t(k),N=t(y),b=t(N,!0);e(N);var M=d(N,2);const P=x(()=>j("events.decode-failed"));ha(M,{get value(){return a(i).userMetadata.summary},get fallback(){return a(P)},children:ta,$$slots:{default:(O,U)=>{const I=x(()=>U.decodedValue);var T=Ta(),B=t(T,!0);e(T),H(()=>D(B,a(I))),u(O,T)}}}),e(y);var F=d(y,2);ga(F,{get status(){return a(i).finalClassification}}),e(k),H(()=>D(b,a(i).label)),u(n,k)}),e($),u(h,g),K(),_()}var Na=p('<div class="py-6 pl-6 text-secondary/70"><p class="text-sm italic"> </p></div>'),Pa=p('<div class="py-6 pl-6 text-secondary/70"><p class="text-sm italic"> </p></div>'),Fa=p('<div class="flex h-full flex-1 flex-col bg-primary"><div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading"> </h3></div> <!></div> <div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading"> </h3></div> <!></div> <div><div class="surface-information w-full px-6 py-2"><h3 data-testid="user-metadata-summary-heading">Events with Metadata</h3></div> <div class="py-6"><!></div></div></div>');function Ia(h,f){G(f,!0);const[l,_]=S(),o=()=>C(A,"$workflowRun",l);var m,v;const E=x(()=>(m=o()===null||o()===void 0?void 0:o().userMetadata)===null||m===void 0?void 0:m.summary),g=x(()=>(v=o()===null||o()===void 0?void 0:o().userMetadata)===null||v===void 0?void 0:v.details);var R=Fa(),W=t(R),$=t(W),n=t($),i=t(n,!0);e(n),e($);var k=d($,2);{var y=s=>{Q(s,{className:"p-3",overrideTheme:"primary",get content(){return a(E)}})},N=s=>{var c=Na(),r=t(c),w=t(r,!0);e(r),e(c),H(V=>D(w,V),[()=>j("workflows.no-summary-available")]),u(s,c)};z(k,s=>{a(E)?s(y):s(N,!1)})}e(W);var b=d(W,2),M=t(b),P=t(M),F=t(P,!0);e(P),e(M);var O=d(M,2);{var U=s=>{Q(s,{className:"p-3",overrideTheme:"primary",get content(){return a(g)}})},I=s=>{var c=Pa(),r=t(c),w=t(r,!0);e(r),e(c),H(V=>D(w,V),[()=>j("workflows.no-details-available")]),u(s,c)};z(O,s=>{a(g)?s(U):s(I,!1)})}e(b);var T=d(b,2),B=d(t(T),2),L=t(B);Wa(L,{}),e(B),e(T),e(R),H((s,c)=>{D(i,s),D(F,c)},[()=>j("workflows.summary"),()=>j("workflows.details")]),u(h,R),K(),_()}var ja=p('<div class="flex flex-col bg-primary lg:flex-row"><!> <!></div>');function Ca(h){var f=ja(),l=t(f);Ia(l,{});var _=d(l,2);Ma(_,{}),e(f),u(h,f)}var Ha=p("<!> <!>",1);function de(h,f){G(f,!1),sa();var l=Ha(),_=Z(l);const o=ra(()=>`${j("workflows.user-metadata-tab")} | ${q.params.workflow}`);oa(_,{get title(){return a(o)},get url(){return q.url.href}});var m=d(_,2);Ca(m),u(h,l),K()}export{de as component};
