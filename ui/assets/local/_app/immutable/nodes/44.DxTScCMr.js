import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as qe,l as H,a as Oe,b as Pe,R as ye,s as r,m as s,az as o,g as e,e as y,r as $,d as t,c as I,t as ce,f as J,n as $e,aM as Qe}from"../chunks/DYX0w8bX.js";import{t as C,a as g,c as ze,b as xe}from"../chunks/Bz76f8pg.js";import{i as We}from"../chunks/CZRFLhJG.js";import{a as K,s as Te,e as Ae}from"../chunks/CgU0heln.js";import{p as Ie}from"../chunks/DeZDeXIv.js";import{P as Fe}from"../chunks/navuEww_.js";import{t as c}from"../chunks/D2OY9xdY.js";import{W as Ne}from"../chunks/DVKG5U0f.js";import{s as ue}from"../chunks/CxFVcq4O.js";import{a as Ge}from"../chunks/BS7N7SXQ.js";import{i as ke}from"../chunks/B_BuKjdB.js";import{e as He,i as Je}from"../chunks/CgLBepva.js";import{o as Ke}from"../chunks/DsexP6Wk.js";import{P as Ve}from"../chunks/f5dZrn0N.js";import{B as Xe}from"../chunks/ZOeVgMqH.js";import{C as Ye}from"../chunks/DuX5BOdb.js";import{C as Ze}from"../chunks/Do8Dk9fo.js";import{E as he}from"../chunks/C1XTKaKf.js";import{L as et}from"../chunks/724y1XB3.js";import{S as tt,O as rt}from"../chunks/BBqcFO8R.js";import{T as ot}from"../chunks/Cg-zGock.js";import{a as st,b as at}from"../chunks/2tgwZOoo.js";import{a as nt}from"../chunks/Bij_J0Ni.js";import{w as be}from"../chunks/D0drot8M.js";import{e as lt}from"../chunks/C3yq_nhW.js";import{s as it}from"../chunks/CTBtQUu0.js";var ct=C('<div class="text-center"><!> <p class="-mt-10"> </p></div>'),ut=C('<!> <div class="flex flex-col gap-1"><!></div> <div class="flex w-full flex-wrap items-end justify-end gap-4"><!></div>',1),dt=C('<div class="ml-auto"><!></div> <!>',1),ft=C('<div class="flex w-3/4 gap-4 max-2xl:w-full max-lg:flex-col"><!> <div class="flex w-full flex-col gap-2"><!></div></div>'),mt=C("<section><!></section>");function pt(V,X){qe(X,!1);const[j,Y]=Te(),P=()=>K(Ie,"$page",j),n=()=>K(be,"$workflowRun",j),f=()=>K(nt,"$authUser",j),_=s(),U=s(),m=s();var W=s(),R=s(),L=s(),O=s(),Q=s(),z=s();const{namespace:de,workflow:fe,run:me}=P().params,Ce={id:fe,runId:me};let p=s(),Z=s(),x=s(""),ee=s(""),A=s(!1),F=s(!0),pe=s(),te=s();const je=a=>[...a].sort((l,u)=>{const k=l.name.startsWith("__"),i=u.name.startsWith("__");return k&&!i?1:!k&&i?-1:l.name.localeCompare(u.name)});Ke(()=>{n().metadata||Re()});const Re=async()=>{const{settings:a}=P().data,l=await st({namespace:de,workflow:{id:fe,runId:me}},a,f()===null||f()===void 0?void 0:f().accessToken);Ae(be,ye(n).metadata=l,ye(n))},ve=()=>{r(A,!1),r(Z,e(p)),r(ee,e(x))},Se=async a=>{var l;r(A,!0);let u;try{r(te,e(x)?lt({input:e(x),encoding:"json/plain",encodeWithCodec:!1}):Promise.resolve(null)),u=await e(te)}catch{ve();return}r(pe,at({namespace:de,workflow:Ce,queryType:a,queryArgs:u?{payloads:u}:null},(l=P().data)===null||l===void 0?void 0:l.settings,f()===null||f()===void 0?void 0:f().accessToken).finally(()=>{ve()}))};H(()=>(o(Q),o(O),o(L),n()),()=>{r(m,je((r(Q,r(O,r(L,n()===null||n()===void 0?void 0:n().metadata)===null||o(L)===void 0?void 0:o(L).definition)===null||o(O)===void 0?void 0:o(O).queryDefinitions)===null||o(Q)===void 0?void 0:o(Q).filter(a=>(a==null?void 0:a.name)!=="__stack_trace"))||[]))}),H(()=>(e(p),o(z),e(m)),()=>{r(p,e(p)||(r(z,e(m)===null||e(m)===void 0?void 0:e(m)[0])===null||o(z)===void 0?void 0:o(z).name))}),H(()=>(e(Z),e(p),e(x),e(ee)),()=>{r(_,e(Z)!==e(p)||e(x)!==e(ee))}),H(()=>(o(R),o(W),n()),()=>{r(U,r(R,r(W,n().metadata)===null||o(W)===void 0?void 0:o(W).error)===null||o(R)===void 0?void 0:o(R).message)}),Oe(),We();var re=mt(),Be=y(re);{var De=a=>{const l=t(()=>c("common.error-occurred")),u=t(()=>c("workflows.no-workers-running-message")),k=t(()=>{var i,d;return(d=(i=n().metadata)==null?void 0:i.error)==null?void 0:d.message});he(a,{get title(){return e(l)},get content(){return e(u)},get error(){return e(k)}})},Ee=(a,l)=>{{var u=i=>{var d=ct(),S=y(d);et(S,{});var B=I(S,2),oe=y(B,!0);$(B),$(d),ce(h=>ue(oe,h),[()=>c("workflows.no-workers-failure-message")],t),g(i,d)},k=i=>{var d=ft(),S=y(d);Ye(S,{class:"mt-7 flex h-fit w-full flex-col gap-2",children:(h,N)=>{var T=ut(),w=J(T);const b=t(()=>c("workflows.query-type"));tt(w,{id:"query-select",get label(){return e(b)},class:"min-w-fit","data-testid":"query-select",required:!0,get value(){return e(p)},set value(v){r(p,v)},children:(v,ie)=>{var q=ze(),M=J(q);He(M,1,()=>e(m),Je,(Me,ge)=>{let _e=()=>e(ge).name,Ue=t(()=>Qe(e(ge).description,""));rt(Me,{get value(){return _e()},get description(){return e(Ue)},children:(Le,gt)=>{$e();var we=xe();ce(()=>ue(we,_e())),g(Le,we)},$$slots:{default:!0}})}),g(v,q)},$$slots:{default:!0},$$legacy:!0});var D=I(w,2),E=y(D);const se=t(()=>c("workflows.query-arg"));Ve(E,{get label(){return e(se)},get input(){return e(x)},set input(v){r(x,v)},$$legacy:!0}),$(D);var G=I(D,2),ae=y(G);const ne=t(()=>e(_)?"primary":"secondary"),le=t(()=>e(_)?null:"retry");Xe(ae,{get loading(){return e(A)},get variant(){return e(ne)},get leadingIcon(){return e(le)},get disabled(){return e(A)},$$events:{click:()=>Se(e(p))},children:(v,ie)=>{$e();var q=xe();ce(M=>ue(q,M),[()=>e(_)?c("workflows.run-query"):c("workflows.refresh-query")],t),g(v,q)},$$slots:{default:!0}}),$(G),g(h,T)},$$slots:{default:!0}});var B=I(S,2),oe=y(B);Ge(oe,()=>Promise.all([e(pe),e(te)]),null,(h,N)=>{var T=t(()=>{var[q,M]=e(N);return{result:q,_:M}}),w=t(()=>e(T).result),b=dt();const D=t(()=>typeof e(w)!="string"?it(e(w)):e(w));var E=J(b),se=y(E);const G=t(()=>c("workflows.json-formatting"));ot(se,{get label(){return e(G)},labelPosition:"left",id:"json-formatting",get checked(){return e(F)},$$events:{change:()=>r(F,!e(F))}}),$(E);var ae=I(E,2);const ne=t(()=>e(F)?"json":"text"),le=t(()=>c("common.copy-icon-title")),v=t(()=>c("common.copy-success-icon-title")),ie=t(()=>e(_)&&"opacity-50");Ze(ae,{get content(){return e(D)},get language(){return e(ne)},get copyIconTitle(){return e(le)},get copySuccessIconTitle(){return e(v)},testId:"query-result",get class(){return e(ie)}}),g(h,b)},(h,N)=>{const T=t(()=>c("common.error-occurred")),w=t(()=>{var b;return(b=e(N))==null?void 0:b.message});he(h,{get title(){return e(T)},get error(){return e(w)}})}),$(B),$(d),g(i,d)};ke(a,i=>{e(m).length?i(k,!1):i(u)},l)}};ke(Be,a=>{e(U)?a(De):a(Ee,!1)})}$(re),g(V,re),Pe(),Y()}var vt=C("<!> <!>",1);function Nt(V,X){qe(X,!1);const[j,Y]=Te(),P=()=>K(Ie,"$page",j),n=P().params.workflow;We();var f=vt(),_=J(f);const U=t(()=>`${c("workflows.queries-tab")} | ${n}`);Fe(_,{get title(){return e(U)},get url(){return P().url.href}});var m=I(_,2);Ne(m,{children:(W,R)=>{pt(W,{})},$$slots:{default:!0}}),g(V,f),Pe(),Y()}export{Nt as component};
