import"./kdUVXlhB.js";import"./BLjkLUx2.js";import"./BaP1uuNe.js";import"./C7NWYhyJ.js";import"./CTBtQUu0.js";import{h as m}from"./BqNaQ_Wm.js";import{f as g}from"./BogN5CJj.js";import{l as S,i as y,m as R,n as W,o as F,k as h,p as I,g as C,q as B,r as N,s as O,t as v,u as U,v as j,w as V,x as q,y as D}from"./zKVhcdie.js";import{e as K,f as M,g as H}from"./DNNVWk-J.js";import{a as L}from"./B6L3uVBf.js";const E=e=>e.eventType==="WorkflowTaskFailed",P=e=>e.eventType==="WorkflowTaskCompleted",x=e=>S(e)&&A(e)==="ResetWorkflow",A=e=>{var i;const{workflowTaskFailedEventAttributes:{failure:t,cause:r}}=e;return((i=t==null?void 0:t.applicationFailureInfo)==null?void 0:i.type)==="workflowTaskHeartbeatError"?"WorkflowTaskHeartbeatError":K(r)},b=e=>{const t=e.findIndex(E);if(t<0)return;const r=e.findIndex(P),i=e.find(n=>E(n));if(A(i)!=="ResetWorkflow"&&(r<0||t<r))return i},Te=(e,t)=>{if(t==="descending")return b(e);{const r=[...e].reverse();return b(r)}},_=(e,t)=>{var r,i,o,n,l,f,u,c,d,k,T,p,w;try{if(y(e)){const s=(r=e.attributes)==null?void 0:r.firstExecutionRunId,a=(i=e.attributes)==null?void 0:i.originalExecutionRunId;return s===a&&((l=(n=(o=e.attributes)==null?void 0:o.searchAttributes)==null?void 0:n.indexedFields)==null?void 0:l.TemporalScheduledById)?3:1}if(R(e)||W(e)||F(e)&&e.id!=="2"||h(e)||I(e)||C(e)||B(e)||N(e))return 1;if(O(e)){const s=Object.keys(e.attributes.searchAttributes.indexedFields);return(s==null?void 0:s.length)===1&&((c=(u=(f=e.attributes)==null?void 0:f.searchAttributes)==null?void 0:u.indexedFields)!=null&&c.TemporalChangeVersion)?0:1}if(v(e)){if(["core_patch","Version"].includes((d=e==null?void 0:e.attributes)==null?void 0:d.markerName))return 0;const a=(k=e.attributes)==null?void 0:k.workflowTaskCompletedEventId;if(a&&t)return t.has(String(a))?0:(t.add(String(a)),1);if(a)return 1}return x(e)?1:U(e)?2:j(e)?(((T=e.attributes)==null?void 0:T.attempt)||1)-1:V(e)?Math.min(((w=(p=e.attributes)==null?void 0:p.meteringMetadata)==null?void 0:w.nonfirstLocalActivityExecutionAttempts)||0,100):0}catch{return 0}},z=["Unspecified","Scheduled","Open","New","Started","Initiated","Running","Completed","Fired","CancelRequested","TimedOut","Signaled","Canceled","Failed","Terminated"],G=e=>{if(typeof e=="number")return"Unspecified";if(e.includes("RequestCancel"))return"CancelRequested";for(const t of z)if(e.includes(t))return t;return"Unspecified"},J=["closeTime","createTime","currentAttemptScheduledTime","earliestTime","eventTime","executionTime","expirationTime","expireTime","lastAccessTime","lastHeartbeatTime","lastStartedTime","lastUpdateTime","latestTime","releaseTime","scheduledTime","startedTime","startTime","workflowExecutionExpirationTime"],Q=["backoffStartInterval","defaultWorkflowTaskTimeout","firstWorkflowTaskBackoff","heartbeatTimeout","initialInterval","maximumInterval","scheduleToCloseTimeout","scheduleToStartTimeout","startToCloseTimeout","startToFireTimeout","workflowExecutionRetentionPeriod","workflowExecutionRetentionTtl","workflowExecutionTimeout","workflowRunTimeout","workflowTaskTimeout"],X=e=>{for(const t of J)if(t===e)return!0;return!1},Y=e=>{for(const t of Q)if(t===e)return!0;return!1},Z=e=>{if(e===null||e===void 0||typeof e!="object")return!1;const t=Object.keys(e),[r]=t;return!(t.length!==1||typeof e[r]!="string")},$=e=>{for(const t of Object.values(e))return t};function ee(e,t=!1){for(const[r,i]of Object.entries(e))Z(i)&&(e[r]=$(i)),X(r)&&!t&&(e[r]=g(i)),Y(r)&&(e[r]=L(i)),r==="versioningBehavior"&&(e[r]=M(i,"VersioningBehavior"));return m(e,"workerVersion")&&m(e,"deploymentVersion")&&delete e.workerVersion,e}const te=(e,t=()=>!1,r)=>({...e,billableActions:t(e)?0:_(e,r)}),re=(e,t={})=>{const r=String(e.eventId),i=H(e.eventType),o=g(String(e.eventTime)),n=G(i),l=D(i),{key:f,attributes:u}=q(e),c=(e==null?void 0:e.links)||[],d={...e,name:i,id:r,eventType:i,timestamp:o,classification:n,category:l,links:c,billableActions:0,attributes:ee({type:f,...u})};return te(d,t.shouldNotAddBillableAction,t.processedWorkflowTaskIds)},pe=e=>{const t=e.findLast(x),r=o=>t?Number(o.id)<Number(t.eventId):!1,i=new Set;return e.map(o=>re(o,{shouldNotAddBillableAction:r,processedWorkflowTaskIds:i}))},we=e=>e===null||typeof e!="object"||Array.isArray(e)?!1:!!m(e,"eventType"),Ee=e=>{const t={...e};return delete t.name,delete t.id,delete t.timestamp,delete t.classification,delete t.category,delete t.attributes,t};export{Te as a,Ee as f,A as g,we as i,ee as s,pe as t};
