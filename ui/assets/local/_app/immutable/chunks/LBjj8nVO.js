import{J as H,G as R,v as W,E as J,w as C,k as L,y as N,o as V,u as Y,j as K,ac as U}from"./CVkC3v6g.js";import{d as D,e as X}from"./CXa2DXXa.js";import{w as P}from"./DaqIHZoW.js";import{g as Q}from"./kdUVXlhB.js";import{t as O}from"./D2OY9xdY.js";import"./BLjkLUx2.js";import{s as w}from"./CTBtQUu0.js";import{r as m,a as f}from"./4BwH8W02.js";import{v}from"./Dz_GI0CC.js";import{g as $}from"./DVdtJ9wn.js";import{e as E}from"./CA7ajlM4.js";import{o as Z,p as ee}from"./CAIFyhnV.js";function ye(e,s,t,o,r){var i=e,c="",a;H(()=>{if(c===(c=s()??"")){R&&W();return}a!==void 0&&(U(a),a=void 0),c!==""&&(a=J(()=>{if(R){C.data;for(var n=W(),l=n;n!==null&&(n.nodeType!==8||n.data!=="");)l=n,n=L(n);if(n===null)throw N(),V;D(C,l),i=Y(n);return}var u=c+"",h=X(u);D(K(h),h.lastChild),i.before(h)}))})}const we=async(e,s,t,o=fetch)=>(r=100,i="")=>{const c=m("schedules",{namespace:e});return f(c,{params:{maximumPageSize:String(r),nextPageToken:i,...s?{query:s}:{}},request:o,onError:t}).then(({schedules:a,nextPageToken:n})=>({items:a,nextPageToken:n?String(n):""}))};async function Se(e,s=fetch){const t=m("schedule",e);return f(t,{request:s})}async function ke(e,s=fetch){const t=m("schedule",e);return f(t,{request:s,options:{method:"DELETE"}})}async function te({namespace:e,scheduleId:s,body:t}){let o="";const r=a=>{var n;return o=((n=a==null?void 0:a.body)==null?void 0:n.message)??`Error creating schedule: ${a.status}: ${a.statusText}`},i=m("schedule",{namespace:e,scheduleId:s}),{conflictToken:c}=await f(i,{options:{method:"POST",body:w({request_id:v(),...t})},onError:r});return{conflictToken:c,error:o}}async function se({namespace:e,scheduleId:s,body:t}){let o="";const r=c=>{var a;return o=((a=c==null?void 0:c.body)==null?void 0:a.message)??`Error editing schedule: ${c.status}: ${c.statusText}`},i=m("schedule.edit",{namespace:e,scheduleId:s});return await f(i,{options:{method:"POST",body:w({request_id:v(),...t})},onError:r}),{error:o}}async function be({namespace:e,scheduleId:s,reason:t}){const o={patch:{pause:t}},r=m("schedule.patch",{namespace:e,scheduleId:s});return await f(r,{options:{method:"POST",body:w({...o,request_id:v()})},onError:i=>console.error(i)})}async function ve({namespace:e,scheduleId:s,reason:t}){const o={patch:{unpause:t}},r=m("schedule.patch",{namespace:e,scheduleId:s});return await f(r,{options:{method:"POST",body:w({...o,request_id:v()})}})}async function _e({namespace:e,scheduleId:s,overlapPolicy:t}){const o={patch:{triggerImmediately:{overlapPolicy:t}}},r=m("schedule.patch",{namespace:e,scheduleId:s});return await f(r,{options:{method:"POST",body:w({...o,request_id:v()})}})}async function Te({namespace:e,scheduleId:s,overlapPolicy:t,startTime:o,endTime:r}){const i={patch:{backfillRequest:[{overlapPolicy:t,startTime:o,endTime:r}]}},c=m("schedule.patch",{namespace:e,scheduleId:s});return await f(c,{options:{method:"POST",body:w({...i,request_id:v()})}})}const I=e=>e?parseInt(e):0,oe=(e,s,t,o)=>`${I(e)*60*60*24+I(s)*60*60+I(t)*60+I(o)}s`,ne=({months:e=[],daysOfMonth:s=[],daysOfWeek:t=[]})=>{var a,n;const o=e.sort((l,u)=>parseInt(l)-parseInt(u)).join(","),r=s.sort((l,u)=>l-u).join(","),c=(((n=(a=t==null?void 0:t[0])==null?void 0:a.split(","))==null?void 0:n.length)>1?t[0].split(","):t).sort((l,u)=>parseInt(l)-parseInt(u)).join(",");return{month:o,dayOfMonth:r,dayOfWeek:c}},M=e=>e.length===0?null:{indexedFields:{...$(e)}},x=(e,s,t)=>{const{hour:o,minute:r,second:i,phase:c,cronString:a}=s,{preset:n,months:l,days:u,daysOfMonth:h,daysOfWeek:S}=t;if(n==="string"){const d=`${a}#${a}`;e.schedule.spec.cronString=[d],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(n==="interval"){const d=oe(u,o,r,i);e.schedule.spec.interval=[{interval:d,phase:c||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:d,dayOfMonth:k,dayOfWeek:g}=ne({months:l,daysOfMonth:h,daysOfWeek:S});e.schedule.spec.calendar=[{year:"*",month:n==="month"?d:"",dayOfMonth:n==="month"?k:"",dayOfWeek:n==="week"?g:"",hour:o,minute:r,second:i}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}},Ae=async({action:e,spec:s,presets:t})=>{const{namespace:o,name:r,workflowId:i,workflowType:c,taskQueue:a,input:n,encoding:l,messageType:u,searchAttributes:h,workflowSearchAttributes:S}=e;let d;if(n)try{d=await E({input:n,encoding:l,messageType:u})}catch(_){y.set(`${O("data-encoder.encode-error")}: ${_==null?void 0:_.message}`);return}const k={schedule_id:r.trim(),searchAttributes:h.length===0?null:{indexedFields:{...$(h)}},schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:i,workflowType:{name:c},taskQueue:{name:a},input:d?{payloads:d}:null,searchAttributes:S.length===0?null:{indexedFields:{...$(S)}}}}}};x(k,s,t),b.set(!0);const{error:g}=await te({scheduleId:r,namespace:o,body:k});g?(y.set(g),b.set(!1)):setTimeout(()=>{y.set(""),b.set(!1),Q(ee({namespace:o}))},2e3)},Ie=async({action:e,spec:s,presets:t},o,r)=>{var j,F;const{namespace:i,name:c,workflowId:a,workflowType:n,taskQueue:l,input:u,encoding:h,messageType:S,searchAttributes:d,workflowSearchAttributes:k}=e;let g;if(u)try{g=await E({input:u,encoding:h,messageType:S})}catch(p){y.set(`${O("data-encoder.encode-error")}: ${p==null?void 0:p.message}`);return}const{preset:_}=t,T={schedule_id:r,searchAttributes:M(d),schedule:{...o,action:{startWorkflow:{...o.action.startWorkflow,workflowId:a,workflowType:{name:n},taskQueue:{name:l},...u!==void 0&&{input:g?{payloads:g}:null},searchAttributes:M(k)}}}},A=(F=(j=T.schedule.action.startWorkflow)==null?void 0:j.header)==null?void 0:F.fields;if(A&&Object.keys(A).length>0)try{const p=Object.entries(A);for(const[z,B]of p){const G=await E({input:w(B),encoding:"json/plain"});A[z]=G[0]}}catch(p){y.set(`${O("data-encoder.encode-error")}: ${p==null?void 0:p.message}`);return}_==="existing"?T.schedule.spec=o.spec:(x(T,s,t),T.schedule.spec.structuredCalendar=[]),b.set(!0);const{error:q}=await se({namespace:i,scheduleId:r,body:T});q?(y.set(q),b.set(!1)):setTimeout(()=>{Q(Z({namespace:i,scheduleId:c})),y.set(""),b.set(!1)},2e3)},b=P(!1),y=P(""),Oe=P("0");export{Ae as a,Oe as b,we as c,Te as d,y as e,Se as f,ke as g,ye as h,b as l,be as p,Ie as s,_e as t,ve as u};
