import{r as I,t as _,b as O,i as F,c as C,d as y,e as k}from"./B6L3uVBf.js";import{d as L}from"./BGl1DbLa.js";import{c as K}from"./CNft6Wn8.js";import{S as c}from"./S6Q2Q0ub.js";import{g as N}from"./DaqIHZoW.js";import{s as v}from"./C4ry1RZU.js";import{o as p,p as B,d as Y,q as w,g as q,c as P,r as Q}from"./BqNaQ_Wm.js";import{t as V}from"./DPBK-uE3.js";import{i as D}from"./BogN5CJj.js";import{u as M}from"./r4tEnGUl.js";import"./CWj6FrbW.js";import"./69_IOA4Y.js";import{p as H,l as U,a as j,f as S,b as x,s as z,m as J,ah as T,g as $,t as G}from"./CVkC3v6g.js";import{s as X}from"./DUPvQxLd.js";import{i as Z}from"./DpQPgcBL.js";import{c as b,a as g,b as tt}from"./CXa2DXXa.js";import{s as et}from"./DrOJgH2Z.js";import{i as rt}from"./B3G23GpA.js";import{p as E}from"./BNtWe5Xb.js";import{t as ot}from"./D2OY9xdY.js";function st(e,t){I(2,arguments);var r=_(e).getTime(),s=O(t);return new Date(r+s)}var at=36e5;function Pt(e,t){I(2,arguments);var r=O(t);return st(e,r*at)}const nt={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime",runId:"RunId"},it=(e,t)=>!(e===null&&!p(t)||e===void 0||e===""||typeof e=="string"&&e==="undefined"),A=({value:e,type:t,conditional:r})=>t===c.BOOL?e.toLowerCase()==="true":t===c.KEYWORDLIST&&Y(r)?e:`"${e}"`,lt=e=>{const t=nt[e]??e;return typeof t=="string"&&/\s/g.test(t)?"`"+t+"`":t},ut=(e,t,r,s="=",o,n)=>{const i=lt(e);return r==="All"?"":n?`${i} ${r}`:p(s)?`\`${i}\` ${s} ${r}`:F(r)||C(r)?o||N(v)?`${i} ${s} "${y(r)}"`:`${i} BETWEEN "${y(r)}" AND "${k()}"`:B(s)?`\`${i}\` ${s} ${A({value:r,type:t,conditional:s})}`:`\`${i}\`${s}${A({value:r,type:t,conditional:s})}`},ft=(e,t)=>e.map(({attribute:r,type:s,value:o,conditional:n,operator:i,parenthesis:a,customDate:f})=>{if(it(o,n)){let l=ut(r,s,o,n,t,f);return a==="("?l=`(${l}`:a===")"&&(l=`${l})`),i&&(l=`${l} ${i} `),l}}).filter(Boolean),ct=(e=[],t=!1)=>ft(e,t).join(""),R=e=>t=>t.toLowerCase()===e.toLowerCase(),mt=(e,t)=>e[t+1],pt=(e,t)=>e[t+2],dt=(e,t)=>e[t+3],Tt=(e,t)=>e[t-2],gt=R(c.DATETIME),Et=R(c.BOOL),h=()=>({attribute:"",type:c.KEYWORD,value:"",operator:"",parenthesis:"",conditional:""}),ht={ExecutionStatus:c.KEYWORD,StartTime:c.DATETIME,CloseTime:c.DATETIME,WorkflowId:c.KEYWORD,WorkflowType:c.KEYWORD,RunId:c.KEYWORD},Qt=(e,t=ht)=>{const r=V(e),s=[];let o=h();if(!e)return[];try{return r.forEach((n,i)=>{const a=mt(r,i),f=pt(r,i);if(t[n])if(o.attribute=n,o.type=t[n],p(a)){const l=`${a} ${f}`,u=p(l)?dt(r,i):f;o.value=u.toLocaleLowerCase()==="null"?null:u}else if(gt(t[n])){const l=f,u=D(l);if(w(a)){const m=r[i+4],d=D(m);u&&d?(o.value=`BETWEEN "${l}" AND "${m}"`,o.customDate=!0):console.error("Error parsing Datetime field from query")}else u?o.value=l:console.error("Error parsing Datetime field from query")}else Et(o.type)?(o.value=a.replace("=",""),o.conditional="="):o.value=f;if(!o.conditional&&q(n)){const l=`${n} ${a}`;p(l)?o.conditional=l:o.conditional=n}P(n)&&(o.parenthesis=n),Q(n)&&!w(Tt(r,i))&&(o.operator=n,s.push(o),o=h()),i===r.length-1&&(s.push(o),o=h())}),s}catch(n){return console.error("Error setting filter parameters: ",n),[]}},yt=e=>{const t=e.filter(a=>a.attribute==="ExecutionStatus"&&a.value),r=e.filter(a=>a.attribute==="WorkflowId"&&a.value),s=e.filter(a=>a.attribute==="WorkflowType"&&a.value),o=e.filter(a=>a.attribute==="RunId"&&a.value),n=e.filter(a=>(a.attribute==="StartTime"||a.attribute==="CloseTime")&&a.value),i=[t,r,o,s,n].filter(a=>a.length);return i.forEach((a,f)=>{var l,u;a.length&&((l=i[f+1])!=null&&l.length)?a[a.length-1].operator="AND":a.length&&!((u=i[f+1])!=null&&u.length)&&(a[a.length-1].operator="")}),[...t,...r,...o,...s,...n]},wt=e=>(e.forEach((t,r)=>{const s=e[r-1];s&&!s.operator&&(s.operator="AND");const o=e[r+1];o||(t.operator=""),t.operator==="OR"&&(o==null?void 0:o.attribute)!==t.attribute?(t.parenthesis="",t.operator=""):t.operator==="OR"&&(s==null?void 0:s.operator)!=="OR"?t.parenthesis="(":(s==null?void 0:s.operator)==="OR"&&t.operator!=="OR"?t.parenthesis=")":t.parenthesis=""}),e),Vt=L((e,t,r=!1)=>{const s=r?yt(t):wt(t),o=ct(s);M({url:e,parameter:"query",value:o,allowEmpty:!1,clearParameters:[K]})},300),W=["Running","TimedOut","Completed","Failed","ContinuedAsNew","Canceled","Terminated"];function Mt(e){return W.includes(e)}const Ht=["All",...W];function Ut(e,t){H(t,!1);const r=J();let s=E(t,"key",8),o=E(t,"count",8,void 0),n=E(t,"replace",8,void 0);U(()=>(T(s()),T(n()),T(o())),()=>{z(r,ot(s(),{...n(),count:o()}))}),j(),rt();var i=b(),a=S(i);{var f=u=>{var m=tt();G(()=>X(m,$(r))),g(u,m)},l=u=>{var m=b(),d=S(m);et(d,t,"default",{},null),g(u,m)};Z(a,u=>{$(r)!==s()?u(f):u(l,!1)})}g(e,i),x()}export{Ut as T,Qt as a,Pt as b,wt as c,st as d,h as e,Ht as f,Mt as i,ct as t,Vt as u,W as w};
