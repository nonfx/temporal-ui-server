import{h as K}from"./BqNaQ_Wm.js";import{n as p,m as g,o as _,e as v,p as C,q as W,r as z,c as N,s as h,t as F,u as G,v as H,w as J,x as L,y as Q,b as P,d as M,z as V,A as X,B as x,C as Y,D as Z,E as tt,F as it,G as rt,a as et,H as st,I as nt,J as at,K as dt,L as ot,M as ut,N as U,O as R,P as k,Q as T,R as w,S,f,T as m,g as b,U as lt}from"./vye8K-vg.js";import{i as ct}from"./5tIFEFRc.js";import{i as Et,d as ft,g as pt}from"./u8snUbh8.js";import{h as gt}from"./qEOT7B5E.js";const kt=(t,i)=>{let r;return p(t)&&(r=i.find(s=>s.activityId===t.attributes.activityId)),r},mt=(t,i)=>{let r;return g(t)&&(r=i.find(s=>s.scheduledEventId===t.id)),r},Ot=(t,i)=>t.find(r=>{var s,e;if(ct(i))return r.eventIds.has(i.id);if(Et(i))return((s=r.pendingActivity)==null?void 0:s.id)===i.id;if(ft(i))return((e=r==null?void 0:r.pendingNexusOperation)==null?void 0:e.scheduledEventId)===(i==null?void 0:i.scheduledEventId)}),j=t=>F(t)||G(t)||H(t)||J(t)||L(t)||Q(t)||P(t)||M(t)||V(t)||X(t)||x(t)||Y(t),vt=t=>I(t)?t.isFailureOrTimedOut:j(t),q=t=>C(t)||W(t)||z(t)||N(t)||h(t),Ct=t=>I(t)?t.isCanceled:q(t),B=t=>_(t)||v(t),Wt=t=>I(t)?t.isTerminated:B(t),y=t=>Z(t)?String(t.activityTaskStartedEventAttributes.scheduledEventId):C(t)?String(t.activityTaskCanceledEventAttributes.scheduledEventId):tt(t)?String(t.activityTaskCancelRequestedEventAttributes.scheduledEventId):G(t)?String(t.activityTaskFailedEventAttributes.scheduledEventId):F(t)?String(t.activityTaskTimedOutEventAttributes.scheduledEventId):it(t)?String(t.activityTaskCompletedEventAttributes.scheduledEventId):rt(t)?String(t.childWorkflowExecutionStartedEventAttributes.initiatedEventId):v(t)?String(t.childWorkflowExecutionTerminatedEventAttributes.initiatedEventId):et(t)?String(t.childWorkflowExecutionCompletedEventAttributes.initiatedEventId):N(t)?String(t.childWorkflowExecutionCanceledEventAttributes.initiatedEventId):P(t)?String(t.childWorkflowExecutionFailedEventAttributes.initiatedEventId):M(t)?String(t.childWorkflowExecutionTimedOutEventAttributes.initiatedEventId):st(t)?String(t.timerFiredEventAttributes.startedEventId):W(t)?String(t.timerCanceledEventAttributes.startedEventId):nt(t)?String(t.workflowExecutionUpdateCompletedEventAttributes.acceptedEventId):at(t)?String(t.externalWorkflowExecutionSignaledEventAttributes.initiatedEventId):dt(t)?String(t.workflowTaskStartedEventAttributes.scheduledEventId):ot(t)?String(t.workflowTaskCompletedEventAttributes.scheduledEventId):ut(t)?String(t.workflowTaskFailedEventAttributes.scheduledEventId):L(t)?String(t.workflowTaskTimedOutEventAttributes.scheduledEventId):U(t)?String(t.nexusOperationStartedEventAttributes.scheduledEventId):R(t)?String(t.nexusOperationCompletedEventAttributes.scheduledEventId):x(t)?String(t.nexusOperationFailedEventAttributes.scheduledEventId):h(t)?String(t.nexusOperationCanceledEventAttributes.scheduledEventId):t.id,$=t=>{var i,r,s,e,u,n,c,d,l,a,E,O;if(!t)return"";if(p(t))return(r=(i=t.activityTaskScheduledEventAttributes)==null?void 0:i.activityType)==null?void 0:r.name;if(k(t))return`${(s=t.timerStartedEventAttributes)==null?void 0:s.timerId} (${gt(String((e=t.timerStartedEventAttributes)==null?void 0:e.startToFireTimeout))})`;if(T(t))return(u=t.signalExternalWorkflowExecutionInitiatedEventAttributes)==null?void 0:u.signalName;if(w(t))return(n=t.workflowExecutionSignaledEventAttributes)==null?void 0:n.signalName;if(S(t))return f(t)?"Local Activity":(c=t.markerRecordedEventAttributes)==null?void 0:c.markerName;if(m(t))return(l=(d=t.startChildWorkflowExecutionInitiatedEventAttributes)==null?void 0:d.workflowType)==null?void 0:l.name;if(b(t))return(O=(E=(a=t.workflowExecutionUpdateAcceptedEventAttributes)==null?void 0:a.acceptedRequest)==null?void 0:E.input)==null?void 0:O.name;if(g(t))return`${t.nexusOperationScheduledEventAttributes.service}.${t.nexusOperationScheduledEventAttributes.operation}`},At=t=>{if(!t)return"";if(p(t))return"Activity";if(k(t))return"Timer";if(T(t))return"Signal";if(w(t))return"Signal received";if(f(t))return"Local Activity";if(S(t))return"Marker";if(m(t))return"Child Workflow";if(b(t))return"Workflow Update";if(g(t)||U(t))return"Nexus Operation"},ht=t=>{var i,r;return t?f(t)?((r=(i=pt(t))==null?void 0:i.value)==null?void 0:r.toString())??"Local Activity":$(t):""},A=({events:t})=>{let i=0,r;for(const s of t.values()){const e=Number(s.id);e>=i&&(i=e,r=s)}return r},o=t=>{const i=y(t),r=$(t),s=At(t),e=ht(t),{timestamp:u,category:n,classification:c}=t,d=new Map,l=new Set;return d.set(t.id,t),l.add(t.id),{id:i,name:r,label:s,displayName:e,events:d,eventIds:l,initialEvent:t,timestamp:u,category:f(t)?"local-activity":n,classification:c,level:void 0,pendingActivity:void 0,pendingNexusOperation:void 0,userMetadata:t==null?void 0:t.userMetadata,get eventTime(){var a;return(a=this.lastEvent)==null?void 0:a.eventTime},get attributes(){var a;return(a=A(this))==null?void 0:a.attributes},get eventList(){return Array.from(this.events,([a,E])=>E)},get links(){return Array.from(this.events,([a,E])=>E.links).flat()},get lastEvent(){return A(this)},get finalClassification(){return A(this).classification},get isPending(){return!!this.pendingActivity||!!this.pendingNexusOperation||k(this.initialEvent)&&this.eventList.length===1||m(this.initialEvent)&&this.eventList.length===2},get isFailureOrTimedOut(){return!!this.eventList.find(j)},get isCanceled(){return!!this.eventList.find(q)},get isTerminated(){return!!this.eventList.find(B)}}},xt=t=>{if(p(t)||m(t)||k(t)||T(t)||w(t))return o(t);if(S(t))return f(t),o(t);if(b(t)||g(t))return o(t)},Tt=t=>{if(lt(t))return o(t)},D=(t,i,r=void 0,s=void 0)=>{if(!t)return;t.events.set(i.id,i),t.eventIds.add(i.id),t.timestamp=i.timestamp,r&&(t.pendingActivity=r),t.pendingActivity&&t.eventList.length===3&&delete t.pendingActivity,s&&(t.pendingNexusOperation=s);const e=R(i)||x(i)||h(i);t.pendingNexusOperation&&e&&delete t.pendingNexusOperation},Nt=(t,i="ascending",r=[],s=[])=>{const e={},u=n=>{const c=y(n),d=xt(n),l=kt(n,r),a=mt(n,s);d?(e[d.id]=d,l&&(d.pendingActivity=l),a&&(d.pendingNexusOperation=a)):D(e[c],n,l,a)};if(i==="ascending")for(const n of t)u(n);else for(let n=t.length-1;n>=0;n--)u(t[n]);return i==="descending"?Object.values(e).reverse():Object.values(e)},I=t=>t==null?!1:K(t,"events"),Ft=(t,i="ascending")=>{const r={},s=e=>{const u=y(e),n=Tt(e);n?r[n.id]=n:D(r[u],e)};if(i==="ascending")for(const e of t)s(e);else for(let e=t.length-1;e>=0;e--)s(t[e]);return i==="descending"?Object.values(r).reverse():Object.values(r)};export{Ot as a,Ft as b,Ct as c,Wt as d,vt as e,Nt as g,I as i};
