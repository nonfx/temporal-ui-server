import{d as R,w as V,g as P}from"./DsexP6Wk.js";import{p as $}from"./DSa-87So.js";import"./CWj6FrbW.js";import"./69_IOA4Y.js";import{p as $t,l as Dt,a as Ot,c as q,e as M,f as gt,t as yt,b as Ft,ah as Ut,r as K,g as kt,d as It}from"./DYX0w8bX.js";import{s as jt}from"./CxFVcq4O.js";import{i as Pt}from"./B_BuKjdB.js";import{t as tt,a as H}from"./Bz76f8pg.js";import{s as qt}from"./CFGOF_JX.js";import{s as Bt}from"./BoNO6UAY.js";import{i as Qt}from"./CZRFLhJG.js";import{p}from"./BrXzBH3h.js";import{s as Vt,a as zt}from"./CgU0heln.js";import{C as Gt}from"./DuX5BOdb.js";import{I as Xt}from"./4XKYBNTx.js";import{R as Mt,a as _t}from"./DjSFcTzd.js";import{t as x}from"./D2OY9xdY.js";import{P as Kt}from"./f5dZrn0N.js";import{v as At}from"./Dz_GI0CC.js";import{A as B}from"./TBME1SPK.js";import{b as Ht,c as Jt,a as Tt}from"./CS9qRfI-.js";import{g as Zt,h as to,i as oo,j as no}from"./BS7yEvwO.js";import{c as St,t as et,s as eo}from"./BW88WPYR.js";import{s as ro}from"./BLfzHnSh.js";import{i as pt,m as bt,r as E,a as m,b as ao,p as io,c as Rt,d as so,e as co}from"./CbzNcTeF.js";import{a as rt}from"./Bij_J0Ni.js";import{h as lo}from"./DA9jycd7.js";import{e as Q,s as uo}from"./Ddh-PMRR.js";import{p as fo}from"./D-ZSdmvT.js";import{s as b}from"./CTBtQUu0.js";import{i as wo,c as mo,d as xt,e as Eo}from"./qEOT7B5E.js";import{a as ho}from"./keAqgBIn.js";const go=(t,o)=>{var n;return((n=t==null?void 0:t.visibilityStore)==null?void 0:n.includes("elasticsearch"))||pt(o,"1.19")},yo=t=>{var o;return(o=t==null?void 0:t.visibilityStore)==null?void 0:o.includes("elasticsearch")},ot=R([$],([t])=>{var o,n,e;return(e=(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.runtimeEnvironment)==null?void 0:e.isCloud}),ko=R([St,et,ot],([t,o,n])=>go(t,o)||n);R([St,ot],([t,o])=>yo(t)||o);const Tn=V(0),Io=R([$],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.hideWorkflowQueryErrors}),xn=R([$],([t])=>{var o,n;return(n=(o=t.data)==null?void 0:o.settings)==null?void 0:n.refreshWorkflowCountsDisabled}),Wt=R([ot,et],([t,o])=>t||bt("1.23.0",o)),Po=R([$],([t])=>t.url.searchParams.get("query")),An=R([Po,Wt,lo],([t,o,n])=>o&&n&&!t?"ParentWorkflowId is NULL":t),Sn=V(""),pn=V({count:0,newCount:0}),nt=V(""),bn=V(""),_o=["json/plain","json/protobuf"],To=t=>_o.includes(t);var xo=tt("<!> <!>",1),Ao=tt('<div class="flex w-full flex-col gap-2"><!> <!></div>'),So=tt("<!> <div><!> <!></div>",1),po=tt('<div><h5 class="pb-1 text-sm font-medium"> </h5> <!></div>');function Rn(t,o){$t(o,!1);const[n,e]=Vt(),r=()=>zt(i(),"$encoding",n);let a=p(o,"id",24,At),c=p(o,"input",12),i=p(o,"encoding",12),s=p(o,"messageType",12),u=p(o,"error",8,!1),d=p(o,"loading",12,!1),f=p(o,"label",24,()=>x("workflows.input")),l=p(o,"editing",8,!0);Dt(()=>(r(),Ut(s())),()=>{r()==="json/plain"&&s()&&s("")}),Ot(),Qt();var h=po(),g=M(h),y=M(g,!0);K(g);var D=q(g,2);Gt(D,{class:"flex flex-col gap-2",children:(A,O)=>{var W=So(),k=gt(W);Kt(k,{get error(){return u()},get id(){return a()},get editing(){return l()},get input(){return c()},set input(I){c(I)},get loading(){return d()},set loading(I){d(I)},$$legacy:!0});var v=q(k,2),S=M(v);{var w=I=>{var C=Ao(),Y=M(C);const F=It(()=>x("workflows.encoding"));Mt(Y,{get description(){return kt(F)},name:"encoding",get group(){return i()},set group(T){i(T)},children:(T,U)=>{var L=xo(),j=gt(L);_t(j,{id:"json/plain",value:"json/plain",label:"json/plain"});var X=q(j,2);_t(X,{id:"json/protobuf",value:"json/protobuf",label:"json/protobuf"}),H(T,L)},$$slots:{default:!0},$$legacy:!0});var _=q(Y,2);{var G=T=>{const U=It(()=>x("workflows.message-type"));Xt(T,{get label(){return kt(U)},get error(){return u()},id:"messageType",get value(){return s()},set value(L){s(L)},$$legacy:!0})};Pt(_,T=>{r()==="json/protobuf"&&T(G)})}K(C),H(I,C)};Pt(S,I=>{l()&&I(w)})}var N=q(S,2);qt(N,o,"action",{},null),K(v),yt(()=>Bt(v,1,`flex items-end gap-2 ${(l()?"justify-between":"justify-end")??""}`)),H(A,W)},$$slots:{default:!0}}),K(h),yt(()=>jt(y,f())),H(t,h),Ft(),e()}const bo=(t=eo)=>!P(t).disableWriteActions,Ro=(t=[])=>t.map(o=>{const n=ro(o,!0),e=o.activityId,r=o.state;return{...n,id:e,state:to(r)}}),Wo=t=>t?t.map(o=>({...o,state:oo(o.state)})):[],Co=t=>t?t.map(o=>({...o,state:no(o.state)})):[],Lo=t=>!t||!t.indexedFields?{}:{indexedFields:Object.entries(t.indexedFields).reduce((n,[e,r])=>({...n,[e]:Ht(r)}),{})},at=t=>{var T,U,L,j,X,st,ct,lt,ut,dt,ft,wt,mt,Et,ht;const o=Lo(t.workflowExecutionInfo.searchAttributes),n=t.workflowExecutionInfo.memo,e=t.workflowExecutionInfo.type.name,r=t.workflowExecutionInfo.execution.workflowId,a=t.workflowExecutionInfo.execution.runId,c=t.workflowExecutionInfo.startTime,i=t.workflowExecutionInfo.closeTime,s=t.workflowExecutionInfo.executionTime,u=Zt(t.workflowExecutionInfo.status),d=u==="Running",f=t.workflowExecutionInfo.historyLength,l=t.workflowExecutionInfo.historySizeBytes,h=`/workflows/${r}/${a}`,g=((U=(T=t==null?void 0:t.executionConfig)==null?void 0:T.taskQueue)==null?void 0:U.name)||((L=t==null?void 0:t.workflowExecutionInfo)==null?void 0:L.taskQueue),y=(j=t==null?void 0:t.workflowExecutionInfo)==null?void 0:j.mostRecentWorkerVersionStamp,D=(X=t==null?void 0:t.workflowExecutionInfo)==null?void 0:X.assignedBuildId,A=(st=t==null?void 0:t.workflowExecutionInfo)==null?void 0:st.parentNamespaceId,O=(ct=t==null?void 0:t.workflowExecutionInfo)==null?void 0:ct.parentExecution,W=t.workflowExecutionInfo.stateTransitionCount,k=(lt=t.executionConfig)==null?void 0:lt.defaultWorkflowTaskTimeout,v=Ro(t.pendingActivities),S=(t==null?void 0:t.pendingChildren)??[],w=Wo(t==null?void 0:t.pendingNexusOperations),N=t==null?void 0:t.pendingWorkflowTask,I=Co(t==null?void 0:t.callbacks),C=(ut=t.workflowExecutionInfo)==null?void 0:ut.rootExecution,Y=(dt=t.workflowExecutionInfo)==null?void 0:dt.versioningInfo,F=t.workflowExtendedInfo??{};let _,G;return(ft=t==null?void 0:t.executionConfig)!=null&&ft.userMetadata&&(_=(mt=(wt=t==null?void 0:t.executionConfig)==null?void 0:wt.userMetadata)==null?void 0:mt.summary,G=(ht=(Et=t==null?void 0:t.executionConfig)==null?void 0:Et.userMetadata)==null?void 0:ht.details),{name:e,id:r,runId:a,startTime:c,endTime:i,executionTime:s,status:u,historyEvents:f,historySizeBytes:l,searchAttributes:o,memo:n,rootExecution:C,url:h,taskQueue:g,assignedBuildId:D,mostRecentWorkerVersionStamp:y,pendingActivities:v,pendingChildren:S,pendingNexusOperations:w,pendingWorkflowTask:N,callbacks:I,versioningInfo:Y,summary:_,details:G,parentNamespaceId:A,parent:O,stateTransitionCount:W,isRunning:d,defaultWorkflowTaskTimeout:k,workflowExtendedInfo:F,get canBeTerminated(){return d&&bo()}}},z=t=>(t.executions||[]).map(o=>at({workflowExecutionInfo:o}));var J=(t=>(t[t.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL=1]="RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL",t[t.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE=2]="RESET_REAPPLY_EXCLUDE_TYPE_UPDATE",t))(J||{}),Z=(t=>(t[t.RESET_REAPPLY_TYPE_UNSPECIFIED=0]="RESET_REAPPLY_TYPE_UNSPECIFIED",t[t.RESET_REAPPLY_TYPE_SIGNAL=1]="RESET_REAPPLY_TYPE_SIGNAL",t[t.RESET_REAPPLY_TYPE_NONE=2]="RESET_REAPPLY_TYPE_NONE",t[t.RESET_REAPPLY_TYPE_ALL_ELIGIBLE=3]="RESET_REAPPLY_TYPE_ALL_ELIGIBLE",t))(Z||{});const vo={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime"},No=["workflowId","workflowType","timeRange","executionStatus","closeTime"],Yo=t=>!(t===null||t===void 0||t===""||typeof t=="string"&&t==="undefined"),$o=t=>{if(typeof t!="string")return!1;for(const o of No)if(o===t)return!0;return!1},Do=(t,o,n)=>{const e=vo[t];return o==="All"?"":wo(o)||mo(o)?n||P(ko)?`${e} > "${xt(o)}"`:`${e} BETWEEN "${xt(o)}" AND "${Eo()}"`:`${e}="${o}"`},Oo=(t,o)=>Object.entries(t).map(([n,e])=>{if($o(n)&&Yo(e))return Do(n,e,o)}).filter(Boolean),Ct=(t,o=!1)=>Oo(t,o).join(" and ");function Fo(t){console.error("Unhandled action:",t)}const Uo=(t,o)=>{let n;switch(t){case B.Cancel:n=x("workflows.canceled");break;case B.Reset:n=x("workflows.reset");break;case B.Terminate:n=x("workflows.terminated");break;default:Fo(t)}return o?x("workflows.workflow-action-reason-placeholder-with-email",{action:n,email:o}):x("workflows.workflow-action-reason-placeholder",{action:n})},Lt=({action:t,reason:o,email:n})=>{const e=Uo(t,n);return o?[o.trim(),e].join(" "):e},vt=async({namespace:t,query:o})=>{const n="GROUP BY ExecutionStatus",e=E("workflows.count",{namespace:t}),{count:r,groups:a}=await m(e,{params:{query:o?`${o} ${n}`:`${n}`},notifyOnError:!1});return{count:r??"0",groups:a}},Wn=async({namespace:t,query:o})=>{const n='TemporalNamespaceDivision="TemporalScheduler" AND ExecutionStatus="Running"',e=o?`${n} AND ${o}`:n,r=E("workflows.count",{namespace:t}),{count:a}=await m(r,{params:{query:e},notifyOnError:!1});return a??"0"},Nt=async(t,o,n=fetch,e=!1)=>{const r=o.query||Ct(o,e);let a;try{a=decodeURIComponent(r)}catch{a=r}const c=e?"workflows.archived":"workflows";let i="";const s=l=>{var h,g;Rt(l),(h=l==null?void 0:l.body)!=null&&h.message||l!=null&&l.status?i=((g=l==null?void 0:l.body)==null?void 0:g.message)??`Error fetching workflows: ${l.status}: ${l.statusText}`:i="Error fetching workflows: Server failed to respond"},u=E(c,{namespace:t}),{executions:d,nextPageToken:f}=await m(u,{params:{query:a},onError:s,handleError:s,request:n})??{executions:[],nextPageToken:""};return{workflows:z({executions:d}),nextPageToken:String(f),error:i}},Cn=async({namespace:t,workflowId:o,url:n},e=fetch)=>{var d;const r="workflows",a=n??ao(t),c=io(r,{namespace:t}),i=a+c,{executions:s}=await m(i,{params:{query:`WorkflowId="${o}"`,pageSize:"1"},request:e})??{executions:[]},u=(d=z({executions:s}))==null?void 0:d[0];return{runId:u==null?void 0:u.runId}},Ln=async(t,o=fetch,n=!1)=>{const e=n?"workflows.archived":"workflows";let r=!0;const a=i=>{(so(i)||co(i))&&(r=!1)},c=E(e,{namespace:t});return await m(c,{params:{pageSize:"1"},onError:a,handleError:a,request:o}),{authorized:r}},vn=async(t,o,n=fetch)=>Nt(t,o,n,!0);async function it(t,o=fetch){const n=E("workflow",{namespace:t.namespace,workflowId:t.workflowId});return m(n,{request:o,notifyOnError:!1,params:t.runId?{"execution.runId":t.runId}:{}}).then(e=>({workflow:at(e)})).catch(e=>({error:e}))}async function Nn({workflow:t,namespace:o,reason:n,first:e}){const r=E("workflow.terminate",{namespace:o,workflowId:t.id}),a=P(rt).email,c=Lt({reason:n,action:B.Terminate,email:a});return await m(r,{options:{method:"POST",body:b({reason:c,...a&&{identity:a},firstExecutionRunId:e})},notifyOnError:!1,params:e?{}:{"execution.runId":t.runId}})}async function Yn({namespace:t,workflow:{id:o,runId:n}},e=fetch){const r=E("workflow.cancel",{namespace:t,workflowId:o});return m(r,{request:e,notifyOnError:!1,options:{method:"POST"},params:{"execution.runId":n}})}async function $n({namespace:t,workflow:{id:o,runId:n},name:e,input:r,encoding:a,messageType:c}){const i=E("workflow.signal",{namespace:t,workflowId:o,signalName:e}),s=await Q({input:r,encoding:a,messageType:c}),u=P($).data.settings,d=(u==null?void 0:u.version)??"",l=pt(d,"2.22")?{signalName:e,workflowExecution:{workflowId:o,runId:n},input:{payloads:s}}:{signalName:e,input:{payloads:s},params:{"execution.runId":n}};return m(i,{notifyOnError:!1,options:{method:"POST",body:b(l)}})}async function Dn({namespace:t,workflow:{workflowId:o,runId:n},name:e,identity:r,updateId:a,input:c="",encoding:i}){const s=E("workflow.update",{namespace:t,workflowId:o,updateName:e}),u=await Q({input:c,encoding:i});return m(s,{notifyOnError:!1,options:{method:"POST",body:b({workflowExecution:{runId:n},request:{meta:{updateId:a,identity:r},input:{args:{payloads:u}}}})}})}async function On({namespace:t,workflow:{id:o,runId:n},eventId:e,reason:r,includeSignals:a,excludeSignals:c,excludeUpdates:i}){const s=E("workflow.reset",{namespace:t,workflowId:o}),u=P(rt).email,d=Lt({action:B.Reset,reason:r,email:u}),f={workflowExecution:{workflowId:o,runId:n},workflowTaskFinishEventId:e,requestId:At(),reason:d};if(P(ot)||bt("1.24.0",P(et))){const l=[];!c&&!i&&l.push(J.RESET_REAPPLY_EXCLUDE_TYPE_UNSPECIFIED),c&&l.push(J.RESET_REAPPLY_EXCLUDE_TYPE_SIGNAL),i&&l.push(J.RESET_REAPPLY_EXCLUDE_TYPE_UPDATE),f.resetReapplyExcludeTypes=l,f.resetReapplyType=Z.RESET_REAPPLY_TYPE_ALL_ELIGIBLE}else{let l;a?l=Z.RESET_REAPPLY_TYPE_SIGNAL:l=Z.RESET_REAPPLY_TYPE_NONE,f.resetReapplyType=l}return m(s,{notifyOnError:!1,options:{method:"POST",body:b(f)},params:{"execution.runId":n}})}async function Fn(t,o=fetch){const n=r=>{console.error(r)},e=E("workflow",t);return m(e,{request:o,onError:n,handleError:n}).then(at)}async function Un(t,o,n){if(!P(Wt))return[];try{let e=`ParentWorkflowId = "${o}"`;n&&(e+=` AND ParentRunId = "${n}"`);const{workflows:r}=await Nt(t,{query:e});return r}catch{return[]}}const jo=t=>{if(!t.length)return{};const o={};return t.forEach(n=>{o[n.label]=uo(n.value)}),o};async function jn({namespace:t,workflowId:o,taskQueue:n,workflowType:e,input:r,summary:a,details:c,encoding:i,messageType:s,searchAttributes:u}){const d=E("workflow",{namespace:t,workflowId:o});let f,l,h;if(r)try{f=await Q({input:r,encoding:i,messageType:s})}catch{throw new Error("Could not encode input for starting workflow")}try{a&&(l=(await Q({input:b(a),encoding:"json/plain"}))[0]),c&&(h=(await Q({input:b(c),encoding:"json/plain"}))[0])}catch{console.error("Could not encode summary or details for starting workflow")}const g=b({workflowId:o,taskQueue:{name:n},workflowType:{name:e},input:f?{payloads:f}:null,userMetadata:{summary:l,details:h},searchAttributes:u.length===0?null:{indexedFields:{...jo(u)}}});return m(d,{notifyOnError:!1,options:{method:"POST",body:g}})}const qn=async({namespace:t,workflowType:o,workflowId:n})=>{var a,c,i,s,u,d,f,l,h,g;const e=y=>{console.error(y)},r={input:"",encoding:"json/plain",messageType:"",searchAttributes:void 0,summary:"",details:""};try{let y="";o&&n?y=`WorkflowType = "${o}" AND WorkflowId = "${n}"`:o?y=`WorkflowType = "${o}"`:n&&(y=`WorkflowId = "${n}"`);const D=E("workflows",{namespace:t}),A=await m(D,{params:{query:y,pageSize:"1"},handleError:e});if(!((a=A==null?void 0:A.executions)!=null&&a[0]))return r;const O=z(A)[0],W={namespace:t,workflowId:O.id,runId:O.runId},{workflow:k}=await it(W),S=await ho(W),w=await Jt((c=S==null?void 0:S.attributes)==null?void 0:c.input,t,P($).data.settings,P(rt).accessToken,"readable",!1);let N="";if(k.summary){const _=await Tt(k.summary);typeof _=="string"&&(N=_)}let I="";if(k.details){const _=await Tt(k.details);typeof _=="string"&&(I=_)}const C=w!=null&&w.payloads?b((i=w.payloads[0])==null?void 0:i.data):"",Y=w!=null&&w.payloads&&To((u=(s=w.payloads[0])==null?void 0:s.metadata)==null?void 0:u.encoding)?(f=(d=w.payloads[0])==null?void 0:d.metadata)==null?void 0:f.encoding:"json/plain",F=w!=null&&w.payloads?(h=(l=w.payloads[0])==null?void 0:l.metadata)==null?void 0:h.messageType:"";return{input:C,encoding:Y,messageType:F,searchAttributes:(g=k==null?void 0:k.searchAttributes)==null?void 0:g.indexedFields,summary:N,details:I}}catch{return r}},qo=(t,o)=>{const n=new Map;o.forEach(r=>{if(r.parent){const a=`${r.parent.workflowId}:${r.parent.runId}`,c=n.get(a)||[];c.push(r),n.set(a,c)}});const e=(r,a)=>{var u,d;const c=`${r.id}:${r.runId}`,i=n.get(c)||[],s={workflow:r,scheduleId:(d=(u=r==null?void 0:r.searchAttributes)==null?void 0:u.indexedFields)==null?void 0:d.TemporalScheduledById,children:[],rootPaths:[...a,{runId:r.runId,workflowId:r.id}]};return s.children=i.map(f=>e(f,s.rootPaths)),s};return e(t,[])},Bo=({parent:t,workflow:o,children:n,siblingCount:e})=>{const r=n.map(i=>{const s=t?[{runId:t.runId,workflowId:t.id},{runId:o.runId,workflowId:o.id},{runId:i.runId,workflowId:i.id}]:[{runId:o.runId,workflowId:o.id},{runId:i.runId,workflowId:i.id}];return{workflow:i,siblingCount:e,children:[],rootPaths:s}}),a={workflow:o,children:r,rootPaths:t?[{runId:t.runId,workflowId:t.id},{runId:o.runId,workflowId:o.id}]:[{runId:o.runId,workflowId:o.id}]};return t?{workflow:t,children:[a],rootPaths:[{runId:t.runId,workflowId:t.id}]}:a};async function Bn(t,o,n){let e=`RootWorkflowId = "${o}"`;return n&&(e+=` AND RootRunId = "${n}"`),await vt({namespace:t,query:e})}async function Qn(t,o,n){let e=`RootWorkflowId = "${o}"`;n&&(e+=` AND RootRunId = "${n}"`);const r=await it({namespace:t,workflowId:o,runId:n}),a=await Yt(t,{query:e});return qo(r==null?void 0:r.workflow,a)}async function Vn({namespace:t,parentWorkflowId:o,parentRunId:n,workflow:e}){let r;const a=async(s,u)=>{const d=`ParentWorkflowId = "${s}" AND ParentRunId = "${u}"`;return await Yt(t,{query:d})};let c=0;if(o){r=await it({namespace:t,workflowId:o,runId:n});const s=`ParentWorkflowId = "${o}" AND ParentRunId = "${n}"`,{count:u}=await vt({namespace:t,query:s});c=parseInt(u)}const i=await a(e.id,e.runId);return Bo({parent:r==null?void 0:r.workflow,workflow:e,children:i,siblingCount:c})}const Yt=async(t,o,n=fetch,e=!1)=>{const r=o.query||Ct(o,e);let a;try{a=decodeURIComponent(r)}catch{a=r}const c=E("workflows",{namespace:t}),{executions:i}=await fo(async s=>m(c,{token:s,request:n,params:{query:a}}));return z({executions:i})},zn=async(t,o="",n=fetch)=>(e=100,r="")=>{nt.set("");const a=i=>{var s;Rt(i),P(Io)?nt.set(x("workflows.workflows-error-querying")):nt.set(((s=i==null?void 0:i.body)==null?void 0:s.message)||x("workflows.workflows-error-querying"))},c=E("workflows",{namespace:t});return m(c,{params:{pageSize:String(e),nextPageToken:r,...o?{query:o}:{}},request:n,onError:a,handleError:a}).then(({executions:i=[],nextPageToken:s=""})=>({items:z({executions:i}),nextPageToken:s?String(s):""}))};export{Uo as A,nt as B,zn as C,it as D,On as E,$n as F,Dn as G,Rn as P,Ln as a,vt as b,qn as c,xn as d,Sn as e,Cn as f,jo as g,Yn as h,ko as i,Wn as j,bo as k,ot as l,vn as m,Ct as n,To as o,Vn as p,An as q,Tn as r,jn as s,Nn as t,Un as u,Bn as v,pn as w,Qn as x,Fn as y,bn as z};
